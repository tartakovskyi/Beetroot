"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_util=_interopRequireDefault(require("./util"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},l=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),l.forEach(function(e){_defineProperty(t,e,a[e])})}return t}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}var NAME="collapse",VERSION="4.2.1",DATA_KEY="bs.collapse",EVENT_KEY=".".concat(DATA_KEY),DATA_API_KEY=".data-api",JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],Default={toggle:!0,parent:""},DefaultType={toggle:"boolean",parent:"(string|element)"},Event={SHOW:"show".concat(EVENT_KEY),SHOWN:"shown".concat(EVENT_KEY),HIDE:"hide".concat(EVENT_KEY),HIDDEN:"hidden".concat(EVENT_KEY),CLICK_DATA_API:"click".concat(EVENT_KEY).concat(DATA_API_KEY)},ClassName={SHOW:"show",COLLAPSE:"collapse",COLLAPSING:"collapsing",COLLAPSED:"collapsed"},Dimension={WIDTH:"width",HEIGHT:"height"},Selector={ACTIVES:".show, .collapsing",DATA_TOGGLE:'[data-toggle="collapse"]'},Collapse=function(){function o(t,e){_classCallCheck(this,o),this._isTransitioning=!1,this._element=t,this._config=this._getConfig(e),this._triggerArray=[].slice.call(document.querySelectorAll('[data-toggle="collapse"][href="#'.concat(t.id,'"],')+'[data-toggle="collapse"][data-target="#'.concat(t.id,'"]')));for(var a=[].slice.call(document.querySelectorAll(Selector.DATA_TOGGLE)),l=0,n=a.length;l<n;l++){var r=a[l],i=_util.default.getSelectorFromElement(r),s=[].slice.call(document.querySelectorAll(i)).filter(function(e){return e===t});null!==i&&0<s.length&&(this._selector=i,this._triggerArray.push(r))}this._parent=this._config.parent?this._getParent():null,this._config.parent||this._addAriaAndCollapsedClass(this._element,this._triggerArray),this._config.toggle&&this.toggle()}return _createClass(o,[{key:"toggle",value:function(){(0,_jquery.default)(this._element).hasClass(ClassName.SHOW)?this.hide():this.show()}},{key:"show",value:function(){var e,t,a=this;if(!this._isTransitioning&&!(0,_jquery.default)(this._element).hasClass(ClassName.SHOW)&&(this._parent&&0===(e=[].slice.call(this._parent.querySelectorAll(Selector.ACTIVES)).filter(function(e){return"string"==typeof a._config.parent?e.getAttribute("data-parent")===a._config.parent:e.classList.contains(ClassName.COLLAPSE)})).length&&(e=null),!(e&&(t=(0,_jquery.default)(e).not(this._selector).data(DATA_KEY))&&t._isTransitioning))){var l=_jquery.default.Event(Event.SHOW);if((0,_jquery.default)(this._element).trigger(l),!l.isDefaultPrevented()){e&&(o._jQueryInterface.call((0,_jquery.default)(e).not(this._selector),"hide"),t||(0,_jquery.default)(e).data(DATA_KEY,null));var n=this._getDimension();(0,_jquery.default)(this._element).removeClass(ClassName.COLLAPSE).addClass(ClassName.COLLAPSING),this._element.style[n]=0,this._triggerArray.length&&(0,_jquery.default)(this._triggerArray).removeClass(ClassName.COLLAPSED).attr("aria-expanded",!0),this.setTransitioning(!0);var r=n[0].toUpperCase()+n.slice(1),i="scroll".concat(r),s=_util.default.getTransitionDurationFromElement(this._element);(0,_jquery.default)(this._element).one(_util.default.TRANSITION_END,function(){(0,_jquery.default)(a._element).removeClass(ClassName.COLLAPSING).addClass(ClassName.COLLAPSE).addClass(ClassName.SHOW),a._element.style[n]="",a.setTransitioning(!1),(0,_jquery.default)(a._element).trigger(Event.SHOWN)}).emulateTransitionEnd(s),this._element.style[n]="".concat(this._element[i],"px")}}}},{key:"hide",value:function(){var e=this;if(!this._isTransitioning&&(0,_jquery.default)(this._element).hasClass(ClassName.SHOW)){var t=_jquery.default.Event(Event.HIDE);if((0,_jquery.default)(this._element).trigger(t),!t.isDefaultPrevented()){var a=this._getDimension();this._element.style[a]="".concat(this._element.getBoundingClientRect()[a],"px"),_util.default.reflow(this._element),(0,_jquery.default)(this._element).addClass(ClassName.COLLAPSING).removeClass(ClassName.COLLAPSE).removeClass(ClassName.SHOW);var l=this._triggerArray.length;if(0<l)for(var n=0;n<l;n++){var r=this._triggerArray[n],i=_util.default.getSelectorFromElement(r);if(null!==i)(0,_jquery.default)([].slice.call(document.querySelectorAll(i))).hasClass(ClassName.SHOW)||(0,_jquery.default)(r).addClass(ClassName.COLLAPSED).attr("aria-expanded",!1)}this.setTransitioning(!0);this._element.style[a]="";var s=_util.default.getTransitionDurationFromElement(this._element);(0,_jquery.default)(this._element).one(_util.default.TRANSITION_END,function(){e.setTransitioning(!1),(0,_jquery.default)(e._element).removeClass(ClassName.COLLAPSING).addClass(ClassName.COLLAPSE).trigger(Event.HIDDEN)}).emulateTransitionEnd(s)}}}},{key:"setTransitioning",value:function(e){this._isTransitioning=e}},{key:"dispose",value:function(){_jquery.default.removeData(this._element,DATA_KEY),this._config=null,this._parent=null,this._element=null,this._triggerArray=null,this._isTransitioning=null}},{key:"_getConfig",value:function(e){return(e=_objectSpread({},Default,e)).toggle=Boolean(e.toggle),_util.default.typeCheckConfig(NAME,e,DefaultType),e}},{key:"_getDimension",value:function(){return(0,_jquery.default)(this._element).hasClass(Dimension.WIDTH)?Dimension.WIDTH:Dimension.HEIGHT}},{key:"_getParent",value:function(){var e,a=this;_util.default.isElement(this._config.parent)?(e=this._config.parent,void 0!==this._config.parent.jquery&&(e=this._config.parent[0])):e=document.querySelector(this._config.parent);var t='[data-toggle="collapse"][data-parent="'.concat(this._config.parent,'"]'),l=[].slice.call(e.querySelectorAll(t));return(0,_jquery.default)(l).each(function(e,t){a._addAriaAndCollapsedClass(o._getTargetFromElement(t),[t])}),e}},{key:"_addAriaAndCollapsedClass",value:function(e,t){var a=(0,_jquery.default)(e).hasClass(ClassName.SHOW);t.length&&(0,_jquery.default)(t).toggleClass(ClassName.COLLAPSED,!a).attr("aria-expanded",a)}}],[{key:"_getTargetFromElement",value:function(e){var t=_util.default.getSelectorFromElement(e);return t?document.querySelector(t):null}},{key:"_jQueryInterface",value:function(l){return this.each(function(){var e=(0,_jquery.default)(this),t=e.data(DATA_KEY),a=_objectSpread({},Default,e.data(),"object"===_typeof(l)&&l?l:{});if(!t&&a.toggle&&/show|hide/.test(l)&&(a.toggle=!1),t||(t=new o(this,a),e.data(DATA_KEY,t)),"string"==typeof l){if(void 0===t[l])throw new TypeError('No method named "'.concat(l,'"'));t[l]()}})}},{key:"VERSION",get:function(){return VERSION}},{key:"Default",get:function(){return Default}}]),o}();(0,_jquery.default)(document).on(Event.CLICK_DATA_API,Selector.DATA_TOGGLE,function(e){"A"===e.currentTarget.tagName&&e.preventDefault();var a=(0,_jquery.default)(this),t=_util.default.getSelectorFromElement(this),l=[].slice.call(document.querySelectorAll(t));(0,_jquery.default)(l).each(function(){var e=(0,_jquery.default)(this),t=e.data(DATA_KEY)?"toggle":a.data();Collapse._jQueryInterface.call(e,t)})}),_jquery.default.fn[NAME]=Collapse._jQueryInterface,_jquery.default.fn[NAME].Constructor=Collapse,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,Collapse._jQueryInterface};var _default=Collapse;exports.default=_default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbGxhcHNlLmpzIl0sIm5hbWVzIjpbIl9qcXVlcnkiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl91dGlsIiwiTkFNRSIsIlZFUlNJT04iLCJEQVRBX0tFWSIsIkVWRU5UX0tFWSIsImNvbmNhdCIsIkRBVEFfQVBJX0tFWSIsIkpRVUVSWV9OT19DT05GTElDVCIsIiQiLCJmbiIsIkRlZmF1bHQiLCJ0b2dnbGUiLCJwYXJlbnQiLCJEZWZhdWx0VHlwZSIsIlNIT1ciLCJTSE9XTiIsIkhJREUiLCJDT0xMQVBTRSIsIkNPTExBUFNJTkciLCJISURERU4iLCJDTElDS19EQVRBX0FQSSIsIkhFSUdIVCIsIkNPTExBUFNFRCIsIkNvbGxhcHNlIiwiZWxlbWVudCIsImNvbmZpZyIsIl9jbGFzc0NhbGxDaGVjayIsInRoaXMiLCJfaXNUcmFuc2l0aW9uaW5nIiwiX2VsZW1lbnQiLCJfY29uZmlnIiwiX2dldENvbmZpZyIsIl90cmlnZ2VyQXJyYXkiLCJzbGljZSIsImNhbGwiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpZCIsInRvZ2dsZUxpc3QiLCJTZWxlY3RvciIsIkRBVEFfVE9HR0xFIiwiaSIsImxlbmd0aCIsImxlbiIsImVsZW0iLCJzZWxlY3RvciIsIlV0aWwiLCJnZXRTZWxlY3RvckZyb21FbGVtZW50IiwiZm91bmRFbGVtIiwicHVzaCIsIl9wYXJlbnQiLCJmaWx0ZXJFbGVtZW50IiwiX2FkZEFyaWFBbmRDb2xsYXBzZWRDbGFzcyIsImRlZmF1bHQiLCJoYXNDbGFzcyIsIkNsYXNzTmFtZSIsImhpZGUiLCJzaG93IiwiYWN0aXZlcyIsImFjdGl2ZXNEYXRhIiwiX3RoaXMiLCJnZXRBdHRyaWJ1dGUiLCJBQ1RJVkVTIiwiZmlsdGVyIiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJub3QiLCJfc2VsZWN0b3IiLCJkYXRhIiwiRXZlbnQiLCJ0cmlnZ2VyIiwic3RhcnRFdmVudCIsImRpbWVuc2lvbiIsIl9nZXREaW1lbnNpb24iLCJfalF1ZXJ5SW50ZXJmYWNlIiwiYWRkQ2xhc3MiLCJzdHlsZSIsInJlbW92ZUNsYXNzIiwiYXR0ciIsInNldFRyYW5zaXRpb25pbmciLCJjYXBpdGFsaXplZERpbWVuc2lvbiIsInRvVXBwZXJDYXNlIiwic2Nyb2xsU2l6ZSIsImdldFRyYW5zaXRpb25EdXJhdGlvbkZyb21FbGVtZW50IiwidHJhbnNpdGlvbkR1cmF0aW9uIiwib25lIiwiVFJBTlNJVElPTl9FTkQiLCJlbXVsYXRlVHJhbnNpdGlvbkVuZCIsIl90aGlzMiIsImlzRGVmYXVsdFByZXZlbnRlZCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInJlZmxvdyIsInRyaWdnZXJBcnJheUxlbmd0aCIsIiRlbGVtIiwiY29tcGxldGUiLCJpc1RyYW5zaXRpb25pbmciLCJyZW1vdmVEYXRhIiwiQm9vbGVhbiIsInR5cGVDaGVja0NvbmZpZyIsIkRpbWVuc2lvbiIsIl90aGlzMyIsImlzRWxlbWVudCIsImpxdWVyeSIsInF1ZXJ5U2VsZWN0b3IiLCJjaGlsZHJlbiIsImVhY2giLCJfZ2V0VGFyZ2V0RnJvbUVsZW1lbnQiLCJ0cmlnZ2VyQXJyYXkiLCJpc09wZW4iLCJ0b2dnbGVDbGFzcyIsIiR0aGlzIiwiX29iamVjdFNwcmVhZCIsIl90eXBlb2YiLCJ0ZXN0IiwiVHlwZUVycm9yIiwib24iLCJldmVudCIsImN1cnJlbnRUYXJnZXQiLCJ0YWdOYW1lIiwicHJldmVudERlZmF1bHQiLCIkdHJpZ2dlciIsInNlbGVjdG9ycyIsIiR0YXJnZXQiLCJDb25zdHJ1Y3RvciIsIm5vQ29uZmxpY3QiXSwibWFwcGluZ3MiOiIyRkFPQSxJQUFBQSxRQUFBQyx1QkFBQUMsUUFBQSxXQUNBQyxNQUFBRix1QkFBQUMsUUFBQSw4cUNBUUEsSUFBTUUsS0FBc0IsV0FDdEJDLFFBQXNCLFFBQ3RCQyxTQUFzQixjQUN0QkMsVUFBUyxJQUFBQyxPQUFpQkYsVUFDMUJHLGFBQXNCLFlBQ3RCQyxtQkFBc0JDLFFBQUFBLFFBQUVDLEdBQUdSLE1BRTNCUyxRQUFVLENB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RixLQUFBd0YsRUFBakJqRyxPQVFFRixRQUFBQSxRQUFBQSxHQUFBQSxNQUFTbUQsU0FBQUEsaUJBQ1ZsRSxRQUFBQSxRQUFBQyxHQUxEUixNQUFBMEgsWUFBQXBHLFNBTURmLFFBQUFBLFFBaEJEQyxHQUFBUixNQUFBMkgsV0FBQSxXQTRCRSxPQVZGcEgsUUFBQUEsUUFBQUMsR0FBQVIsTUFBQU0sbUJBVVNnQixTQUFTbUQsK0JBR0huRCIsImZpbGUiOiJjb2xsYXBzZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIEJvb3RzdHJhcCAodjQuMi4xKTogY29sbGFwc2UuanNcbiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICovXG5cbmltcG9ydCAkIGZyb20gJ2pxdWVyeSdcbmltcG9ydCBVdGlsIGZyb20gJy4vdXRpbCdcblxuLyoqXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIENvbnN0YW50c1xuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKi9cblxuY29uc3QgTkFNRSAgICAgICAgICAgICAgICA9ICdjb2xsYXBzZSdcbmNvbnN0IFZFUlNJT04gICAgICAgICAgICAgPSAnNC4yLjEnXG5jb25zdCBEQVRBX0tFWSAgICAgICAgICAgID0gJ2JzLmNvbGxhcHNlJ1xuY29uc3QgRVZFTlRfS0VZICAgICAgICAgICA9IGAuJHtEQVRBX0tFWX1gXG5jb25zdCBEQVRBX0FQSV9LRVkgICAgICAgID0gJy5kYXRhLWFwaSdcbmNvbnN0IEpRVUVSWV9OT19DT05GTElDVCAgPSAkLmZuW05BTUVdXG5cbmNvbnN0IERlZmF1bHQgPSB7XG4gIHRvZ2dsZSA6IHRydWUsXG4gIHBhcmVudCA6ICcnXG59XG5cbmNvbnN0IERlZmF1bHRUeXBlID0ge1xuICB0b2dnbGUgOiAnYm9vbGVhbicsXG4gIHBhcmVudCA6ICcoc3RyaW5nfGVsZW1lbnQpJ1xufVxuXG5jb25zdCBFdmVudCA9IHtcbiAgU0hPVyAgICAgICAgICAgOiBgc2hvdyR7RVZFTlRfS0VZfWAsXG4gIFNIT1dOICAgICAgICAgIDogYHNob3duJHtFVkVOVF9LRVl9YCxcbiAgSElERSAgICAgICAgICAgOiBgaGlkZSR7RVZFTlRfS0VZfWAsXG4gIEhJRERFTiAgICAgICAgIDogYGhpZGRlbiR7RVZFTlRfS0VZfWAsXG4gIENMSUNLX0RBVEFfQVBJIDogYGNsaWNrJHtFVkVOVF9LRVl9JHtEQVRBX0FQSV9LRVl9YFxufVxuXG5jb25zdCBDbGFzc05hbWUgPSB7XG4gIFNIT1cgICAgICAgOiAnc2hvdycsXG4gIENPTExBUFNFICAgOiAnY29sbGFwc2UnLFxuICBDT0xMQVBTSU5HIDogJ2NvbGxhcHNpbmcnLFxuICBDT0xMQVBTRUQgIDogJ2NvbGxhcHNlZCdcbn1cblxuY29uc3QgRGltZW5zaW9uID0ge1xuICBXSURUSCAgOiAnd2lkdGgnLFxuICBIRUlHSFQgOiAnaGVpZ2h0J1xufVxuXG5jb25zdCBTZWxlY3RvciA9IHtcbiAgQUNUSVZFUyAgICAgOiAnLnNob3csIC5jb2xsYXBzaW5nJyxcbiAgREFUQV9UT0dHTEUgOiAnW2RhdGEtdG9nZ2xlPVwiY29sbGFwc2VcIl0nXG59XG5cbi8qKlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBDbGFzcyBEZWZpbml0aW9uXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqL1xuXG5jbGFzcyBDb2xsYXBzZSB7XG4gIGNvbnN0cnVjdG9yKGVsZW1lbnQsIGNvbmZpZykge1xuICAgIHRoaXMuX2lzVHJhbnNpdGlvbmluZyA9IGZhbHNlXG4gICAgdGhpcy5fZWxlbWVudCAgICAgICAgID0gZWxlbWVudFxuICAgIHRoaXMuX2NvbmZpZyAgICAgICAgICA9IHRoaXMuX2dldENvbmZpZyhjb25maWcpXG4gICAgdGhpcy5fdHJpZ2dlckFycmF5ICAgID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFxuICAgICAgYFtkYXRhLXRvZ2dsZT1cImNvbGxhcHNlXCJdW2hyZWY9XCIjJHtlbGVtZW50LmlkfVwiXSxgICtcbiAgICAgIGBbZGF0YS10b2dnbGU9XCJjb2xsYXBzZVwiXVtkYXRhLXRhcmdldD1cIiMke2VsZW1lbnQuaWR9XCJdYFxuICAgICkpXG5cbiAgICBjb25zdCB0b2dnbGVMaXN0ID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFNlbGVjdG9yLkRBVEFfVE9HR0xFKSlcbiAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdG9nZ2xlTGlzdC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgY29uc3QgZWxlbSA9IHRvZ2dsZUxpc3RbaV1cbiAgICAgIGNvbnN0IHNlbGVjdG9yID0gVXRpbC5nZXRTZWxlY3RvckZyb21FbGVtZW50KGVsZW0pXG4gICAgICBjb25zdCBmaWx0ZXJFbGVtZW50ID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKSlcbiAgICAgICAgLmZpbHRlcigoZm91bmRFbGVtKSA9PiBmb3VuZEVsZW0gPT09IGVsZW1lbnQpXG5cbiAgICAgIGlmIChzZWxlY3RvciAhPT0gbnVsbCAmJiBmaWx0ZXJFbGVtZW50Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhpcy5fc2VsZWN0b3IgPSBzZWxlY3RvclxuICAgICAgICB0aGlzLl90cmlnZ2VyQXJyYXkucHVzaChlbGVtKVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuX3BhcmVudCA9IHRoaXMuX2NvbmZpZy5wYXJlbnQgPyB0aGlzLl9nZXRQYXJlbnQoKSA6IG51bGxcblxuICAgIGlmICghdGhpcy5fY29uZmlnLnBhcmVudCkge1xuICAgICAgdGhpcy5fYWRkQXJpYUFuZENvbGxhcHNlZENsYXNzKHRoaXMuX2VsZW1lbnQsIHRoaXMuX3RyaWdnZXJBcnJheSlcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fY29uZmlnLnRvZ2dsZSkge1xuICAgICAgdGhpcy50b2dnbGUoKVxuICAgIH1cbiAgfVxuXG4gIC8vIEdldHRlcnNcblxuICBzdGF0aWMgZ2V0IFZFUlNJT04oKSB7XG4gICAgcmV0dXJuIFZFUlNJT05cbiAgfVxuXG4gIHN0YXRpYyBnZXQgRGVmYXVsdCgpIHtcbiAgICByZXR1cm4gRGVmYXVsdFxuICB9XG5cbiAgLy8gUHVibGljXG5cbiAgdG9nZ2xlKCkge1xuICAgIGlmICgkKHRoaXMuX2VsZW1lbnQpLmhhc0NsYXNzKENsYXNzTmFtZS5TSE9XKSkge1xuICAgICAgdGhpcy5oaWRlKClcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zaG93KClcbiAgICB9XG4gIH1cblxuICBzaG93KCkge1xuICAgIGlmICh0aGlzLl9pc1RyYW5zaXRpb25pbmcgfHxcbiAgICAgICQodGhpcy5fZWxlbWVudCkuaGFzQ2xhc3MoQ2xhc3NOYW1lLlNIT1cpKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBsZXQgYWN0aXZlc1xuICAgIGxldCBhY3RpdmVzRGF0YVxuXG4gICAgaWYgKHRoaXMuX3BhcmVudCkge1xuICAgICAgYWN0aXZlcyA9IFtdLnNsaWNlLmNhbGwodGhpcy5fcGFyZW50LnF1ZXJ5U2VsZWN0b3JBbGwoU2VsZWN0b3IuQUNUSVZFUykpXG4gICAgICAgIC5maWx0ZXIoKGVsZW0pID0+IHtcbiAgICAgICAgICBpZiAodHlwZW9mIHRoaXMuX2NvbmZpZy5wYXJlbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtcGFyZW50JykgPT09IHRoaXMuX2NvbmZpZy5wYXJlbnRcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gZWxlbS5jbGFzc0xpc3QuY29udGFpbnMoQ2xhc3NOYW1lLkNPTExBUFNFKVxuICAgICAgICB9KVxuXG4gICAgICBpZiAoYWN0aXZlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgYWN0aXZlcyA9IG51bGxcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoYWN0aXZlcykge1xuICAgICAgYWN0aXZlc0RhdGEgPSAkKGFjdGl2ZXMpLm5vdCh0aGlzLl9zZWxlY3RvcikuZGF0YShEQVRBX0tFWSlcbiAgICAgIGlmIChhY3RpdmVzRGF0YSAmJiBhY3RpdmVzRGF0YS5faXNUcmFuc2l0aW9uaW5nKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHN0YXJ0RXZlbnQgPSAkLkV2ZW50KEV2ZW50LlNIT1cpXG4gICAgJCh0aGlzLl9lbGVtZW50KS50cmlnZ2VyKHN0YXJ0RXZlbnQpXG4gICAgaWYgKHN0YXJ0RXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGlmIChhY3RpdmVzKSB7XG4gICAgICBDb2xsYXBzZS5falF1ZXJ5SW50ZXJmYWNlLmNhbGwoJChhY3RpdmVzKS5ub3QodGhpcy5fc2VsZWN0b3IpLCAnaGlkZScpXG4gICAgICBpZiAoIWFjdGl2ZXNEYXRhKSB7XG4gICAgICAgICQoYWN0aXZlcykuZGF0YShEQVRBX0tFWSwgbnVsbClcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBkaW1lbnNpb24gPSB0aGlzLl9nZXREaW1lbnNpb24oKVxuXG4gICAgJCh0aGlzLl9lbGVtZW50KVxuICAgICAgLnJlbW92ZUNsYXNzKENsYXNzTmFtZS5DT0xMQVBTRSlcbiAgICAgIC5hZGRDbGFzcyhDbGFzc05hbWUuQ09MTEFQU0lORylcblxuICAgIHRoaXMuX2VsZW1lbnQuc3R5bGVbZGltZW5zaW9uXSA9IDBcblxuICAgIGlmICh0aGlzLl90cmlnZ2VyQXJyYXkubGVuZ3RoKSB7XG4gICAgICAkKHRoaXMuX3RyaWdnZXJBcnJheSlcbiAgICAgICAgLnJlbW92ZUNsYXNzKENsYXNzTmFtZS5DT0xMQVBTRUQpXG4gICAgICAgIC5hdHRyKCdhcmlhLWV4cGFuZGVkJywgdHJ1ZSlcbiAgICB9XG5cbiAgICB0aGlzLnNldFRyYW5zaXRpb25pbmcodHJ1ZSlcblxuICAgIGNvbnN0IGNvbXBsZXRlID0gKCkgPT4ge1xuICAgICAgJCh0aGlzLl9lbGVtZW50KVxuICAgICAgICAucmVtb3ZlQ2xhc3MoQ2xhc3NOYW1lLkNPTExBUFNJTkcpXG4gICAgICAgIC5hZGRDbGFzcyhDbGFzc05hbWUuQ09MTEFQU0UpXG4gICAgICAgIC5hZGRDbGFzcyhDbGFzc05hbWUuU0hPVylcblxuICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZVtkaW1lbnNpb25dID0gJydcblxuICAgICAgdGhpcy5zZXRUcmFuc2l0aW9uaW5nKGZhbHNlKVxuXG4gICAgICAkKHRoaXMuX2VsZW1lbnQpLnRyaWdnZXIoRXZlbnQuU0hPV04pXG4gICAgfVxuXG4gICAgY29uc3QgY2FwaXRhbGl6ZWREaW1lbnNpb24gPSBkaW1lbnNpb25bMF0udG9VcHBlckNhc2UoKSArIGRpbWVuc2lvbi5zbGljZSgxKVxuICAgIGNvbnN0IHNjcm9sbFNpemUgPSBgc2Nyb2xsJHtjYXBpdGFsaXplZERpbWVuc2lvbn1gXG4gICAgY29uc3QgdHJhbnNpdGlvbkR1cmF0aW9uID0gVXRpbC5nZXRUcmFuc2l0aW9uRHVyYXRpb25Gcm9tRWxlbWVudCh0aGlzLl9lbGVtZW50KVxuXG4gICAgJCh0aGlzLl9lbGVtZW50KVxuICAgICAgLm9uZShVdGlsLlRSQU5TSVRJT05fRU5ELCBjb21wbGV0ZSlcbiAgICAgIC5lbXVsYXRlVHJhbnNpdGlvbkVuZCh0cmFuc2l0aW9uRHVyYXRpb24pXG5cbiAgICB0aGlzLl9lbGVtZW50LnN0eWxlW2RpbWVuc2lvbl0gPSBgJHt0aGlzLl9lbGVtZW50W3Njcm9sbFNpemVdfXB4YFxuICB9XG5cbiAgaGlkZSgpIHtcbiAgICBpZiAodGhpcy5faXNUcmFuc2l0aW9uaW5nIHx8XG4gICAgICAhJCh0aGlzLl9lbGVtZW50KS5oYXNDbGFzcyhDbGFzc05hbWUuU0hPVykpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNvbnN0IHN0YXJ0RXZlbnQgPSAkLkV2ZW50KEV2ZW50LkhJREUpXG4gICAgJCh0aGlzLl9lbGVtZW50KS50cmlnZ2VyKHN0YXJ0RXZlbnQpXG4gICAgaWYgKHN0YXJ0RXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNvbnN0IGRpbWVuc2lvbiA9IHRoaXMuX2dldERpbWVuc2lvbigpXG5cbiAgICB0aGlzLl9lbGVtZW50LnN0eWxlW2RpbWVuc2lvbl0gPSBgJHt0aGlzLl9lbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpW2RpbWVuc2lvbl19cHhgXG5cbiAgICBVdGlsLnJlZmxvdyh0aGlzLl9lbGVtZW50KVxuXG4gICAgJCh0aGlzLl9lbGVtZW50KVxuICAgICAgLmFkZENsYXNzKENsYXNzTmFtZS5DT0xMQVBTSU5HKVxuICAgICAgLnJlbW92ZUNsYXNzKENsYXNzTmFtZS5DT0xMQVBTRSlcbiAgICAgIC5yZW1vdmVDbGFzcyhDbGFzc05hbWUuU0hPVylcblxuICAgIGNvbnN0IHRyaWdnZXJBcnJheUxlbmd0aCA9IHRoaXMuX3RyaWdnZXJBcnJheS5sZW5ndGhcbiAgICBpZiAodHJpZ2dlckFycmF5TGVuZ3RoID4gMCkge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlnZ2VyQXJyYXlMZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCB0cmlnZ2VyID0gdGhpcy5fdHJpZ2dlckFycmF5W2ldXG4gICAgICAgIGNvbnN0IHNlbGVjdG9yID0gVXRpbC5nZXRTZWxlY3RvckZyb21FbGVtZW50KHRyaWdnZXIpXG5cbiAgICAgICAgaWYgKHNlbGVjdG9yICE9PSBudWxsKSB7XG4gICAgICAgICAgY29uc3QgJGVsZW0gPSAkKFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikpKVxuICAgICAgICAgIGlmICghJGVsZW0uaGFzQ2xhc3MoQ2xhc3NOYW1lLlNIT1cpKSB7XG4gICAgICAgICAgICAkKHRyaWdnZXIpLmFkZENsYXNzKENsYXNzTmFtZS5DT0xMQVBTRUQpXG4gICAgICAgICAgICAgIC5hdHRyKCdhcmlhLWV4cGFuZGVkJywgZmFsc2UpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zZXRUcmFuc2l0aW9uaW5nKHRydWUpXG5cbiAgICBjb25zdCBjb21wbGV0ZSA9ICgpID0+IHtcbiAgICAgIHRoaXMuc2V0VHJhbnNpdGlvbmluZyhmYWxzZSlcbiAgICAgICQodGhpcy5fZWxlbWVudClcbiAgICAgICAgLnJlbW92ZUNsYXNzKENsYXNzTmFtZS5DT0xMQVBTSU5HKVxuICAgICAgICAuYWRkQ2xhc3MoQ2xhc3NOYW1lLkNPTExBUFNFKVxuICAgICAgICAudHJpZ2dlcihFdmVudC5ISURERU4pXG4gICAgfVxuXG4gICAgdGhpcy5fZWxlbWVudC5zdHlsZVtkaW1lbnNpb25dID0gJydcbiAgICBjb25zdCB0cmFuc2l0aW9uRHVyYXRpb24gPSBVdGlsLmdldFRyYW5zaXRpb25EdXJhdGlvbkZyb21FbGVtZW50KHRoaXMuX2VsZW1lbnQpXG5cbiAgICAkKHRoaXMuX2VsZW1lbnQpXG4gICAgICAub25lKFV0aWwuVFJBTlNJVElPTl9FTkQsIGNvbXBsZXRlKVxuICAgICAgLmVtdWxhdGVUcmFuc2l0aW9uRW5kKHRyYW5zaXRpb25EdXJhdGlvbilcbiAgfVxuXG4gIHNldFRyYW5zaXRpb25pbmcoaXNUcmFuc2l0aW9uaW5nKSB7XG4gICAgdGhpcy5faXNUcmFuc2l0aW9uaW5nID0gaXNUcmFuc2l0aW9uaW5nXG4gIH1cblxuICBkaXNwb3NlKCkge1xuICAgICQucmVtb3ZlRGF0YSh0aGlzLl9lbGVtZW50LCBEQVRBX0tFWSlcblxuICAgIHRoaXMuX2NvbmZpZyAgICAgICAgICA9IG51bGxcbiAgICB0aGlzLl9wYXJlbnQgICAgICAgICAgPSBudWxsXG4gICAgdGhpcy5fZWxlbWVudCAgICAgICAgID0gbnVsbFxuICAgIHRoaXMuX3RyaWdnZXJBcnJheSAgICA9IG51bGxcbiAgICB0aGlzLl9pc1RyYW5zaXRpb25pbmcgPSBudWxsXG4gIH1cblxuICAvLyBQcml2YXRlXG5cbiAgX2dldENvbmZpZyhjb25maWcpIHtcbiAgICBjb25maWcgPSB7XG4gICAgICAuLi5EZWZhdWx0LFxuICAgICAgLi4uY29uZmlnXG4gICAgfVxuICAgIGNvbmZpZy50b2dnbGUgPSBCb29sZWFuKGNvbmZpZy50b2dnbGUpIC8vIENvZXJjZSBzdHJpbmcgdmFsdWVzXG4gICAgVXRpbC50eXBlQ2hlY2tDb25maWcoTkFNRSwgY29uZmlnLCBEZWZhdWx0VHlwZSlcbiAgICByZXR1cm4gY29uZmlnXG4gIH1cblxuICBfZ2V0RGltZW5zaW9uKCkge1xuICAgIGNvbnN0IGhhc1dpZHRoID0gJCh0aGlzLl9lbGVtZW50KS5oYXNDbGFzcyhEaW1lbnNpb24uV0lEVEgpXG4gICAgcmV0dXJuIGhhc1dpZHRoID8gRGltZW5zaW9uLldJRFRIIDogRGltZW5zaW9uLkhFSUdIVFxuICB9XG5cbiAgX2dldFBhcmVudCgpIHtcbiAgICBsZXQgcGFyZW50XG5cbiAgICBpZiAoVXRpbC5pc0VsZW1lbnQodGhpcy5fY29uZmlnLnBhcmVudCkpIHtcbiAgICAgIHBhcmVudCA9IHRoaXMuX2NvbmZpZy5wYXJlbnRcblxuICAgICAgLy8gSXQncyBhIGpRdWVyeSBvYmplY3RcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5fY29uZmlnLnBhcmVudC5qcXVlcnkgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHBhcmVudCA9IHRoaXMuX2NvbmZpZy5wYXJlbnRbMF1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcGFyZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLl9jb25maWcucGFyZW50KVxuICAgIH1cblxuICAgIGNvbnN0IHNlbGVjdG9yID1cbiAgICAgIGBbZGF0YS10b2dnbGU9XCJjb2xsYXBzZVwiXVtkYXRhLXBhcmVudD1cIiR7dGhpcy5fY29uZmlnLnBhcmVudH1cIl1gXG5cbiAgICBjb25zdCBjaGlsZHJlbiA9IFtdLnNsaWNlLmNhbGwocGFyZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpKVxuICAgICQoY2hpbGRyZW4pLmVhY2goKGksIGVsZW1lbnQpID0+IHtcbiAgICAgIHRoaXMuX2FkZEFyaWFBbmRDb2xsYXBzZWRDbGFzcyhcbiAgICAgICAgQ29sbGFwc2UuX2dldFRhcmdldEZyb21FbGVtZW50KGVsZW1lbnQpLFxuICAgICAgICBbZWxlbWVudF1cbiAgICAgIClcbiAgICB9KVxuXG4gICAgcmV0dXJuIHBhcmVudFxuICB9XG5cbiAgX2FkZEFyaWFBbmRDb2xsYXBzZWRDbGFzcyhlbGVtZW50LCB0cmlnZ2VyQXJyYXkpIHtcbiAgICBjb25zdCBpc09wZW4gPSAkKGVsZW1lbnQpLmhhc0NsYXNzKENsYXNzTmFtZS5TSE9XKVxuXG4gICAgaWYgKHRyaWdnZXJBcnJheS5sZW5ndGgpIHtcbiAgICAgICQodHJpZ2dlckFycmF5KVxuICAgICAgICAudG9nZ2xlQ2xhc3MoQ2xhc3NOYW1lLkNPTExBUFNFRCwgIWlzT3BlbilcbiAgICAgICAgLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCBpc09wZW4pXG4gICAgfVxuICB9XG5cbiAgLy8gU3RhdGljXG5cbiAgc3RhdGljIF9nZXRUYXJnZXRGcm9tRWxlbWVudChlbGVtZW50KSB7XG4gICAgY29uc3Qgc2VsZWN0b3IgPSBVdGlsLmdldFNlbGVjdG9yRnJvbUVsZW1lbnQoZWxlbWVudClcbiAgICByZXR1cm4gc2VsZWN0b3IgPyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSA6IG51bGxcbiAgfVxuXG4gIHN0YXRpYyBfalF1ZXJ5SW50ZXJmYWNlKGNvbmZpZykge1xuICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgJHRoaXMgICA9ICQodGhpcylcbiAgICAgIGxldCBkYXRhICAgICAgPSAkdGhpcy5kYXRhKERBVEFfS0VZKVxuICAgICAgY29uc3QgX2NvbmZpZyA9IHtcbiAgICAgICAgLi4uRGVmYXVsdCxcbiAgICAgICAgLi4uJHRoaXMuZGF0YSgpLFxuICAgICAgICAuLi50eXBlb2YgY29uZmlnID09PSAnb2JqZWN0JyAmJiBjb25maWcgPyBjb25maWcgOiB7fVxuICAgICAgfVxuXG4gICAgICBpZiAoIWRhdGEgJiYgX2NvbmZpZy50b2dnbGUgJiYgL3Nob3d8aGlkZS8udGVzdChjb25maWcpKSB7XG4gICAgICAgIF9jb25maWcudG9nZ2xlID0gZmFsc2VcbiAgICAgIH1cblxuICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgIGRhdGEgPSBuZXcgQ29sbGFwc2UodGhpcywgX2NvbmZpZylcbiAgICAgICAgJHRoaXMuZGF0YShEQVRBX0tFWSwgZGF0YSlcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBjb25maWcgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGlmICh0eXBlb2YgZGF0YVtjb25maWddID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYE5vIG1ldGhvZCBuYW1lZCBcIiR7Y29uZmlnfVwiYClcbiAgICAgICAgfVxuICAgICAgICBkYXRhW2NvbmZpZ10oKVxuICAgICAgfVxuICAgIH0pXG4gIH1cbn1cblxuLyoqXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIERhdGEgQXBpIGltcGxlbWVudGF0aW9uXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqL1xuXG4kKGRvY3VtZW50KS5vbihFdmVudC5DTElDS19EQVRBX0FQSSwgU2VsZWN0b3IuREFUQV9UT0dHTEUsIGZ1bmN0aW9uIChldmVudCkge1xuICAvLyBwcmV2ZW50RGVmYXVsdCBvbmx5IGZvciA8YT4gZWxlbWVudHMgKHdoaWNoIGNoYW5nZSB0aGUgVVJMKSBub3QgaW5zaWRlIHRoZSBjb2xsYXBzaWJsZSBlbGVtZW50XG4gIGlmIChldmVudC5jdXJyZW50VGFyZ2V0LnRhZ05hbWUgPT09ICdBJykge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgfVxuXG4gIGNvbnN0ICR0cmlnZ2VyID0gJCh0aGlzKVxuICBjb25zdCBzZWxlY3RvciA9IFV0aWwuZ2V0U2VsZWN0b3JGcm9tRWxlbWVudCh0aGlzKVxuICBjb25zdCBzZWxlY3RvcnMgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpKVxuXG4gICQoc2VsZWN0b3JzKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCAkdGFyZ2V0ID0gJCh0aGlzKVxuICAgIGNvbnN0IGRhdGEgICAgPSAkdGFyZ2V0LmRhdGEoREFUQV9LRVkpXG4gICAgY29uc3QgY29uZmlnICA9IGRhdGEgPyAndG9nZ2xlJyA6ICR0cmlnZ2VyLmRhdGEoKVxuICAgIENvbGxhcHNlLl9qUXVlcnlJbnRlcmZhY2UuY2FsbCgkdGFyZ2V0LCBjb25maWcpXG4gIH0pXG59KVxuXG4vKipcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogalF1ZXJ5XG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqL1xuXG4kLmZuW05BTUVdID0gQ29sbGFwc2UuX2pRdWVyeUludGVyZmFjZVxuJC5mbltOQU1FXS5Db25zdHJ1Y3RvciA9IENvbGxhcHNlXG4kLmZuW05BTUVdLm5vQ29uZmxpY3QgPSAoKSA9PiB7XG4gICQuZm5bTkFNRV0gPSBKUVVFUllfTk9fQ09ORkxJQ1RcbiAgcmV0dXJuIENvbGxhcHNlLl9qUXVlcnlJbnRlcmZhY2Vcbn1cblxuZXhwb3J0IGRlZmF1bHQgQ29sbGFwc2VcbiJdfQ==
